<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fun Employed - Oda Sistemi</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; background-color: #f0f0f0; margin: 0; padding: 20px; }
        #game-container { background-color: white; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); max-width: 600px; margin: 0 auto; }
        #create-room, #join-room, #setup, #game { display: none; }
        #create-room.active, #join-room.active, #setup.active, #game.active { display: block; }
        #player-list, #room-code-input { width: 80%; margin: 10px 0; }
        #player-list { height: 100px; }
        #output, #room-info { margin: 20px 0; }
        button { padding: 10px 20px; background-color: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background-color: #45a049; }
        #start-game-btn { display: none; }
    </style>
</head>
<body>
    <div id="game-container">
        <h1>Fun Employed - Online</h1>

        <!-- Oda Oluşturma Ekranı -->
        <div id="create-room" class="active">
            <button onclick="createRoom()">Oda Oluştur</button>
            <button onclick="showJoinRoom()">Odaya Katıl</button>
        </div>

        <!-- Odaya Katılma Ekranı -->
        <div id="join-room">
            <p>Oda kodunu gir:</p>
            <input type="text" id="room-code-input" placeholder="Oda kodu">
            <br>
            <button onclick="joinRoom()">Katıl</button>
            <button onclick="showCreateRoom()">Geri Dön</button>
        </div>

        <!-- İsim Girme Ekranı -->
        <div id="setup">
            <div id="room-info"></div>
            <p>İsmini gir:</p>
            <input type="text" id="player-name" placeholder="İsmin">
            <br>
            <button onclick="addPlayer()">İsmi Ekle</button>
            <div id="player-list"></div>
            <button id="start-game-btn" onclick="startGame()">Oyunu Başlat</button>
        </div>

        <!-- Oyun Ekranı -->
        <div id="game">
            <div id="output"></div>
            <button onclick="newRound()">Yeni Tur</button>
        </div>
    </div>

    <!-- Firebase 8.10.1 SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <script>
        // Firebase yapılandırması (kendi projenden al)
        const firebaseConfig = {
  apiKey: "AIzaSyB5KiEUTNfao86swcobrgIpJfPT3hKL3jY",
  authDomain: "funemployedonline.firebaseapp.com",
  databaseURL: "https://funemployedonline-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "funemployedonline",
  storageBucket: "funemployedonline.firebasestorage.app",
  messagingSenderId: "500515044000",
  appId: "1:500515044000:web:41426d793010798fb5a7c5",
  measurementId: "G-C1MCHF79LP"
};
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let currentRoomCode = null;
        let isRoomCreator = false;
        let players = [];
        const jobs = [
            "Hayvanat Bahçesi Müdürü",
            "Uzay Turizmi Rehberi",
            "Çikolata Tadım Uzmanı",
            "Korsan Gemisi Kaptanı",
            "Robot Tamircisi"
        ];
        const traitsPool = [
            "Her zaman yanında bir ukulele taşır.", "Hayvanlarla konuşabildiğine inanır.", "Toplantılarda sürekli şeker yer.",
            "Daha önce bir sirke palyaço olarak çalıştı.", "Günde 10 bardak kahve içer.", "Kendi icadı bir dans hareketi var.",
            "Her şeye alerjisi var gibi davranır.", "Çocukken astronot olmak istiyordu.", "Sürekli espri yapar ama kimse gülmez.",
            "Her yere bisikletle gider.", "Duvarda gölgesini kung-fu yapıyormuş gibi gösterir.", "Kendi kendine şarkı mırıldanır.",
            "Ayakkabılarını hep yanlış bağlar.", "Her zaman yanlış kapıyı çalar.", "Kedilere fısıldayan biri olduğunu iddia eder.",
            "Sürekli yanlış kelimeleri kullanır.", "Her şeye ‘vay canına’ der.", "Telefonunu sürekli düşürür.",
            "Yemek yerken garip sesler çıkarır.", "Her zaman yanlış saatte uyanır.", "Sürekli bir şeyleri unutur.",
            "Kendi uydurduğu bir dilde konuşur.", "Her şeye aşırı tepki verir.", "Sürekli not alır ama nereye koyduğunu unutur.",
            "Her zaman yanlış otobüse biner.", "Parmaklarını çıtlatmaktan hoşlanır.", "Her yere geç kalır ama bahane bulur.",
            "Sürekli aynı hikayeyi anlatır.", "Her şeye ‘bence’ diye başlar.", "Kendi kendine kahkaha atar.",
            "Her zaman yanlış yöne yürür.", "Sürekli bir şeyleri devirir.", "Her şeye ‘eski usul’ der.",
            "Bir şey bulamayınca ‘biri çaldı’ der.", "Her zaman yanlış numarayı arar.", "Sürekli bir şeyleri tamir etmeye çalışır ama bozar.",
            "Her şeye ‘tabii ki’ diye cevap verir.", "Sürekli bir şeyleri yanlış anlar.", "Her zaman yanlış sırayı takip eder.",
            "Sürekli ‘bir saniye’ der ama geri dönmez.", "Her şeye ‘düşüncem şu’ diye başlar.", "Sürekli bir şeyleri kaybeder.",
            "Her zaman yanlış şapkayı takar.", "Sürekli ‘bunu ben yaparım’ der ama yapamaz.", "Her şeye ‘eski bir dostum’ hikayesiyle başlar.",
            "Sürekli yanlış sandalyeye oturur.", "Her zaman yanlış anahtarı kullanır.", "Sürekli ‘bir fikrim var’ der ama yoktur.",
            "Her şeye ‘bunu daha önce gördüm’ der.", "Sürekli yanlış çorabı giyer.", "Her zaman yanlış bardaktan içer.",
            "Sürekli ‘birazdan’ der ama yapmaz.", "Her şeye ‘ben demiştim’ der.", "Sürekli yanlış düğmeye basar.",
            "Her zaman yanlış kitabı okur.", "Sürekli ‘bir şey duydum’ der ama duymamıştır.", "Her şeye ‘eski bir gelenek’ der.",
            "Sürekli yanlış şemsiyeyi alır.", "Her zaman yanlış çantayı taşır.", "Sürekli ‘bir planım var’ der ama yoktur.",
            "Her şeye ‘bunu ben buldum’ der.", "Sürekli yanlış yoldan gider.", "Her zaman yanlış kapıyı açar.",
            "Sürekli ‘bir şey hatırladım’ der ama hatırlamaz.", "Her şeye ‘bunu yaparım’ der ama yapmaz.", "Sürekli yanlış saati takip eder.",
            "Her zaman yanlış dosyayı açar.", "Sürekli ‘bir şey buldum’ der ama bulmamıştır.", "Her şeye ‘eski bir numara’ der.",
            "Sürekli yanlış kalemi kullanır.", "Her zaman yanlış notu alır.", "Sürekli ‘bir şey gördüm’ der ama görmemiştir.",
            "Her şeye ‘bunu biliyorum’ der ama bilmez.", "Sürekli yanlış tabağı alır.", "Her zaman yanlış koltuğa oturur.",
            "Sürekli ‘bir şey mi dedin?’ der.", "Her şeye ‘eski bir alışkanlık’ der.", "Sürekli yanlış telefonu şarj eder.",
            "Her zaman yanlış ışığı açar.", "Sürekli ‘bir şey yapıyorum’ der ama yapmaz.", "Her şeye ‘bunu çözdüm’ der ama çözmez.",
            "Sürekli yanlış çorabı çeker.", "Her zaman yanlış fincanı kullanır.", "Sürekli ‘bir şey duydum mu?’ der.",
            "Her şeye ‘eski bir taktik’ der.", "Sürekli yanlış şapkayı düşürür.", "Her zaman yanlış yiyeceği yer.",
            "Sürekli ‘bir şey mi söyledim?’ der.", "Her şeye ‘bunu hallederim’ der ama halledemez.", "Sürekli yanlış çantayı açar.",
            "Her zaman yanlış dosyayı siler.", "Sürekli ‘bir şey mi kaybettim?’ der.", "Her şeye ‘eski bir hile’ der.",
            "Sürekli yanlış saate bakar.", "Her zaman yanlış kitabı alır.", "Sürekli ‘bir şey mi yaptım?’ der.",
            "Her şeye ‘bunu gördüm’ der ama görmemiştir.", "Sürekli yanlış anahtarı düşürür.", "Her zaman yanlış kapıyı çalar.",
            "Sürekli ‘bir şey mi unuttum?’ der.", "Her şeye ‘eski bir yöntem’ der.", "Sürekli yanlış şemsiyeyi açar.",
            "Her zaman yanlış bardakla içer.", "Sürekli ‘bir şey mi söyledim?’ der.", "Her şeye ‘bunu yapabilirim’ der ama yapamaz.",
            "Sürekli yanlış kalemi düşürür.", "Her zaman yanlış notu yazar.", "Sürekli ‘bir şey mi buldum?’ der ama bulmamıştır.",
            "Her şeye ‘eski bir fikir’ der.", "Sürekli yanlış tabağı düşürür.", "Her zaman yanlış koltuğu seçer.",
            "Sürekli ‘bir şey mi duydum?’ der.", "Her şeye ‘bunu hatırlıyorum’ der ama hatırlamaz.", "Sürekli yanlış telefonu açar.",
            "Her zaman yanlış ışığı kapatır.", "Sürekli ‘bir şey mi yaptım?’ der ama yapmamıştır.", "Her şeye ‘eski bir plan’ der."
        ];

        function getRandomTraits(count) {
            let traits = [];
            let availableTraits = [...traitsPool];
            for (let i = 0; i < count; i++) {
                let randomIndex = Math.floor(Math.random() * availableTraits.length);
                traits.push(availableTraits[randomIndex]);
                availableTraits.splice(randomIndex, 1);
            }
            return traits;
        }

        function createRoom() {
            currentRoomCode = Math.random().toString(36).substring(2, 8).toUpperCase(); // Rastgele 6 karakterlik kod
            isRoomCreator = true;
            db.ref(`rooms/${currentRoomCode}`).set({
                players: [],
                gameStarted: false
            });
            showSetupScreen();
        }

        function joinRoom() {
            const roomCode = document.getElementById("room-code-input").value.trim().toUpperCase();
            if (!roomCode) {
                alert("Lütfen bir oda kodu gir!");
                return;
            }
            db.ref(`rooms/${roomCode}`).once("value", (snapshot) => {
                if (snapshot.exists()) {
                    currentRoomCode = roomCode;
                    isRoomCreator = false;
                    showSetupScreen();
                } else {
                    alert("Böyle bir oda bulunamadı!");
                }
            });
        }

        function showSetupScreen() {
            document.getElementById("create-room").classList.remove("active");
            document.getElementById("join-room").classList.remove("active");
            document.getElementById("setup").classList.add("active");
            document.getElementById("room-info").innerHTML = `Oda Kodu: <strong>${currentRoomCode}</strong>`;
            if (isRoomCreator) {
                document.getElementById("start-game-btn").style.display = "block";
            }
            listenForPlayers();
        }

        function showJoinRoom() {
            document.getElementById("create-room").classList.remove("active");
            document.getElementById("join-room").classList.add("active");
        }

        function showCreateRoom() {
            document.getElementById("join-room").classList.remove("active");
            document.getElementById("create-room").classList.add("active");
        }

        function addPlayer() {
            const playerName = document.getElementById("player-name").value.trim();
            if (!playerName) {
                alert("Lütfen bir isim gir!");
                return;
            }
            db.ref(`rooms/${currentRoomCode}/players`).once("value", (snapshot) => {
                let currentPlayers = snapshot.val() || [];
                if (!currentPlayers.includes(playerName)) {
                    currentPlayers.push(playerName);
                    db.ref(`rooms/${currentRoomCode}/players`).set(currentPlayers);
                }
                document.getElementById("player-name").value = "";
            });
        }

        function listenForPlayers() {
            db.ref(`rooms/${currentRoomCode}`).on("value", (snapshot) => {
                const data = snapshot.val();
                if (!data) return;
                players = data.players || [];
                document.getElementById("player-list").innerHTML = players.length > 0
                    ? `Katılan Oyuncular: ${players.join(", ")}`
                    : "Henüz kimse katılmadı.";
                if (data.gameStarted) {
                    document.getElementById("setup").classList.remove("active");
                    document.getElementById("game").classList.add("active");
                    displayGame();
                }
            });
        }

        function startGame() {
            if (!isRoomCreator) return;
            if (players.length < 2) {
                alert("En az 2 oyuncu olmalı!");
                return;
            }
            db.ref(`rooms/${currentRoomCode}/gameStarted`).set(true);
            saveAndDisplayRound();
        }

        function saveAndDisplayRound() {
            const jobHolderIndex = Math.floor(Math.random() * players.length);
            const randomJob = jobs[Math.floor(Math.random() * jobs.length)];
            let gameData = {};

            players.forEach((player, index) => {
                if (index === jobHolderIndex) {
                    gameData[player] = { type: "job", value: randomJob };
                } else {
                    gameData[player] = { type: "traits", value: getRandomTraits(4) };
                }
            });

            db.ref(`rooms/${currentRoomCode}/gameData`).set(gameData);
        }

        function newRound() {
            saveAndDisplayRound();
        }

        function displayGame() {
            db.ref(`rooms/${currentRoomCode}/gameData`).on("value", (snapshot) => {
                const data = snapshot.val();
                if (!data) return;
                let html = "";
                for (let player in data) {
                    if (data[player].type === "job") {
                        html += `<p><strong>${player}</strong>: İş Pozisyonu - ${data[player].value}</p>`;
                    } else {
                        html += `<p><strong>${player}</strong>: Özellikler - ${data[player].value.join(", ")}</p>`;
                    }
                }
                document.getElementById("output").innerHTML = html;
            });
        }
    </script>
</body>
</html>
